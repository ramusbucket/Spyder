@model List<string>
<div class="help-block"></div>
<div class="jumbotron text-center">
    <h1 class="text-center">Mongo saver service</h1>
    <h2>Status:<span class="text-success">Active</span></h2>
</div>

<div class="row text-center">
    <a class="btn btn-success" href="/Home/StartSavers">Start savers</a>
</div>

<div class="row">
    @foreach (var saver in this.Model)
    {
        <div class="row">
            <h1>@saver</h1>
            <p id="@saver">Statistics</p>
        </div>
    }
</div>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
        $(function () {
            // Reference the auto-generated proxy for the hub.
            var serviceStatistics = $.connection.serviceStatisticsHub;
            // Create a function that the hub can call back to display messages.
            serviceStatistics.client.pushStatistics = function (result) {
                // Add the message to the page.

                //LastException
                //LastExceptionDate
                //LastExceptionMessage
                //LastPollDate
                //LastProcessedItemDate
                //LastReceivedMessageDate
                //ProcessedItemsCount
                //StartDate
                var stats = JSON.parse(result);

                for (val of result) {
                    var saver = val.Saver;
                    var saverStats = val.Stats;

                    $(`#${saver}`).innerText = JSON.stringify(saverStats);
                }

                console.log(stats);
                // Parse statistics to a readable json
            };

            $.connection.hub
                .start()
                .done(function () {
                    alert("Connected");

                    $("#getServiceStatus").click(function () {
                        serviceStatistics.server.getServiceStatus();
                    })
                });
        });
        // This optional function html-encodes messages for display in the page.
    </script>
}